# ChatZoo

ChatZooï¼Œä¸€æ¬¾è½»é‡çº§çš„å¤§æ¨¡å‹è¯„æµ‹å·¥å…·ã€‚

[![Github Repo Stars](https://img.shields.io/github/stars/openlmlab/chatzoo?style=social)](https://github.com/openlmlab/chatzoo/stargazers)
[![GitHub](https://img.shields.io/github/license/OpenLMLab/chatzoo)]()
[![HuggingFace badge](https://img.shields.io/badge/%F0%9F%A4%97HuggingFace-Join-yellow)](https://huggingface.co/openlmlab)
[![GitHub commit activity (branch)](https://img.shields.io/github/commit-activity/w/OpenLMLab/collie)](https://github.com/OpenLMLab/collie/commits/main)
[![GitHub issues](https://img.shields.io/github/issues/OpenLMLab/collie)](https://github.com/OpenLMLab/collie/issues)

<h4 align="center">
  <p>
     [ <a href="">ç®€ä½“ä¸­æ–‡</a> ] |
     [ <a href="">English</a> ]
  </p>
</h4>

## æ–°é—»

## ç›®å½•

<ul>
    <li><a href="#ChatZooæ˜¯ä»€ä¹ˆ">ChatZooæ˜¯ä»€ä¹ˆ?</a></li>
    <li><a href="#ç‰¹æ€§">ç‰¹æ€§</a></li>
    <li><a href="#å®‰è£…">å®‰è£…</a></li>
    <li><a href="#ä½¿ç”¨">ä½¿ç”¨</a></li>
    <li><a href="å¼•ç”¨æˆ‘ä»¬">å¼•ç”¨æˆ‘ä»¬</a></li>
</ul>

## ChatZooæ˜¯ä»€ä¹ˆï¼Ÿ

ChatZooæ˜¯ä¸€æ¬¾è½»é‡çº§å¤§æ¨¡å‹è¯„æµ‹å·¥å…·ã€‚ä½œä¸ºä¸€åå¤§æ¨¡å‹è¡Œä¸šçš„çˆ±å¥½è€…æˆ–ä»ä¸šè€…ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ChatZooæ¥è°ƒè¯•å’Œè¯„æµ‹å„ç§å¤§æ¨¡å‹çš„è¡¨ç°ã€‚å®ƒä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„ç¯å¢ƒï¼Œè®©æ‚¨èƒ½å¤Ÿä¸å¤šä¸ªæ¨¡å‹åŒæ—¶å¯¹è¯ï¼Œå¹¶è¯„ä¼°å®ƒä»¬çš„å“åº”è´¨é‡ã€è¯­ä¹‰å‡†ç¡®æ€§å’Œæµç•…åº¦ã€‚

![Image](docs/pics/image.png)

## ç‰¹æ€§

* ğŸ‘ **è½»æ¾ä¸Šæ‰‹**
  
  ä»…éœ€ä¸€è¡Œå‘½ä»¤å³å¯å¿«é€Ÿå¯åŠ¨æ•´ä¸ªæœåŠ¡ï¼Œè®©æ‚¨è½»æ¾ä¸Šæ‰‹ã€‚

* ğŸ„**ç•Œé¢ç¾è§‚**
  
  ChatZooæä¾›ä¸€é”®æ¢è‚¤å’Œä»£ç æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œè®©æ‚¨èƒ½å¤Ÿäº«å—åˆ°æ›´åŠ ä¸ªæ€§åŒ–å’Œèˆ’é€‚çš„ä½“éªŒã€‚

* ğŸ‘Œ**æ–¹ä¾¿å¯¼å‡º**

  ä¼šè¯æ•°æ®æ”¯æŒä¸€é”®ä¸‹è½½ï¼ŒæŠ•ç¥¨ç»“æœä»¥å›¾è¡¨çš„æ–¹å¼å‘ˆç°ï¼Œä¾¿äºåˆ†æã€‚

* ğŸ”’**éšç§ä¿æŠ¤**

   æ•´ä¸ªç³»ç»Ÿæ”¯æŒæœ¬åœ°éƒ¨ç½²ï¼Œä¿éšœèŠå¤©æ•°æ®çš„éšç§å®‰å…¨ï¼Œç¡®ä¿ä¸ä¼šæ³„éœ²ã€‚

* ğŸ¤—**å¼€æºå¼€æ”¾**

  æ‚¨å¯ä»¥è·å–æºä»£ç ï¼Œå¹¶è‡ªç”±åœ°æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½¿ChatZooæ›´ç¬¦åˆæ‚¨çš„éœ€æ±‚ã€‚

## å®‰è£…

åœ¨å®‰è£…å‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿ï¼š

* Python3
* Node.js >= 18.5.0ï¼ˆğŸ‘‰å¼€å‘è€…ï¼‰

æ‚¨å¯ä»¥ç›´æ¥é€šè¿‡`git clone`æ¥è·å–æ•´ä¸ªå·¥ç¨‹æ–‡ä»¶ï¼š

```bash
git clone https://github.com/OpenLMLab/ChatZoo.git
```

ä¸‹è½½å®Œæˆåï¼Œæ‚¨åªéœ€è¦åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œ

```bash
pip install -r requirements.txt
```

æ¥å®‰è£…æ‰€æœ‰éœ€è¦çš„ä¾èµ–ã€‚

## ä½¿ç”¨

![pipeline](docs/pics/pipeline.png)

å½“æ‚¨æˆåŠŸå®‰è£…ChatZooåï¼Œåªéœ€è¦åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œ`python main.py --config config.py`å³å¯æ‹‰èµ·æ•´ä¸ªæœåŠ¡ã€‚

åœ¨`config.py`ä¸­ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œä¿®æ”¹ä»¥è®¾å®šä½ éœ€è¦çš„é…ç½®ï¼Œä¸‹é¢æä¾›ä¸€ä¸ªåŸºç¡€çš„æ ·ä¾‹ï¼š

```python
# æ¨¡å‹åˆ—è¡¨ï¼šç•Œé¢æ‰“å¼€æ—¶å‡ºç°çš„æ¨¡å‹ã€‚ï¼ˆæœ€å¤š4ä¸ªæ¨¡å‹ï¼‰
model_list = [
    {
        # æ¨¡å‹åç§°ï¼ˆå‚è€ƒHuggingFaceä¸­çš„åç§°ï¼Œå¿…éœ€ï¼‰
        "model_name_or_path": "THUDM/chatglm2-6b-32k",
        # æ¨¡å‹æ˜µç§°ï¼ˆç»™æ¨¡å‹çš„è‡ªå®šä¹‰åç§°ï¼Œå¿…éœ€ä¸”ä¸é‡å¤ï¼‰
        "nickname": "chatglm2-6b-32k",
        # Tokenizerè·¯å¾„ï¼ˆå‚è€ƒHuggingFaceä¸­çš„åç§°ï¼Œå¿…éœ€ï¼‰
        "tokenizer_path": "THUDM/chatglm2-6b-32k",
        # ç”Ÿæˆå‚æ•°ï¼ˆè‹¥ä½¿ç”¨ChatZooå†…è®¾æ¨¡å‹å¯ä¸æŒ‡å®šå¹¶ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼‰
        "generate_kwargs": {
            "max_length": 2048
        },
        # GPU
        "devices": "3",
        # æ•°æ®ç±»å‹
        "dtype": "float16",
        # åŸºç¡€æ¨¡å‹ï¼ˆä»…åœ¨LoRAçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼‰
        "base_model": None,
        # Promptï¼ˆè‹¥ä½¿ç”¨ChatZooå†…è®¾æ¨¡å‹å¯ä¸æŒ‡å®šå¹¶ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼‰
        "prompts": {
             "meta_prompt": "",
             "user_prompt": "é—®: {}\n",
             "bot_prompt": "ç­”: {}\n"
         }
    }
]
# ç”¨æˆ·åˆ—è¡¨
user_list = [
    {
        # ç”¨æˆ·åï¼ˆå¿…éœ€ï¼‰ï¼Œç”¨äºç™»å½•ChatZoo
        "username": "admin",
        # è§’è‰²ï¼ˆå¿…éœ€ï¼‰ï¼Œå¯é€‰annotateï¼ˆæ ‡æ³¨è€…ï¼‰æˆ–è€…debugï¼ˆå¼€å‘è€…ï¼‰
        # å¼€å‘è€…æƒé™ï¼šæ¨¡å‹ç®¡ç†ã€ä¼šè¯æ ‡æ³¨ã€å•è½®æ ‡æ³¨
        # æ ‡æ³¨è€…æƒé™ï¼šä¼šè¯æ ‡æ³¨ã€å•è½®æ ‡æ³¨
        "role": "annotate",
        # æœ€å¤§ä¼šè¯æ ‡æ³¨æ•°é‡
        "session_mark_num": 100, 
        # æœ€å¤§å•è½®æ ‡æ³¨ä¼šè¯æ•°é‡
        "single_mark_num": 100
     },
]
# ä¸»æœºåï¼ˆå¯é€‰ï¼‰ï¼Œé»˜è®¤ä¸ºlocalhost
host_name = "10.140.0.216"
# ç«¯å£ï¼ˆå¯é€‰ï¼‰ï¼Œè‹¥ä¸æŒ‡å®šå°†è‡ªåŠ¨å¯»æ‰¾ç©ºé—²ç«¯å£
port = 8080
# æ¨¡å¼ï¼ˆå¿…éœ€ï¼‰ï¼Œå¯é€‰debugï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰|arenaï¼ˆç«æŠ€åœºæ¨¡å¼ï¼‰
# è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œæ ‡æ³¨è€…ä¸å¯è¿›è¡Œæ ‡æ³¨
mode = "debug"
# æ˜¯å¦æµå¼ç”Ÿæˆï¼ˆå¿…éœ€ï¼‰
is_stream = True
# æ•°æ®åº“ç±»å‹ï¼ˆå¿…éœ€ï¼‰
database_dtype = "sqlite"
# æ•°æ®åº“åœ°å€ï¼ˆå¿…éœ€ï¼‰
database_path = "./data.db"
```

</details>

### æ”¯æŒçš„æ¨¡å‹

ChatZooæä¾›ä¸‰ç§å¯¼å…¥æ¨¡å‹çš„æ–¹å¼ï¼šæœ¬åœ°æ¨¡å‹ã€å¤–éƒ¨ç½‘é¡µæ¥å…¥å’Œé¢„è®¾æ¨¡å‹ã€‚

#### æœ¬åœ°æ¨¡å‹

  ChatZooé€šè¿‡ChatBotç±»æä¾›äº†ä¸€äº›æ¨¡å‹çš„å®ç°ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š
  - [MOSS](https://github.com/OpenLMLab/MOSS)
      - [moss-moon-003-sft](https://huggingface.co/fnlp/moss-moon-003-sft)
      - [moss-moon-003-sft-plugin](https://huggingface.co/fnlp/moss-moon-003-sft-plugin)
      - [moss-moon-003-sft-int8](https://huggingface.co/fnlp/moss-moon-003-sft-int8)
      - [moss-moon-003-sft-plugin-int8](https://huggingface.co/fnlp/moss-moon-003-sft-plugin-int8)
      - [moss-moon-003-sft-int4](https://huggingface.co/fnlp/moss-moon-003-sft-int4)
      - [moss-moon-003-sft-plugin-int4](https://huggingface.co/fnlp/moss-moon-003-sft-plugin-int4)
  - [ChatGLM](https://github.com/THUDM/ChatGLM-6B)
      - [chatglm-6b](https://huggingface.co/THUDM/chatglm-6b)
      - [chatglm2-6b](https://huggingface.co/THUDM/chatglm2-6b)
  - [BELLE](https://github.com/LianjiaTech/BELLE)
      - [BELLE-7B-2M](https://huggingface.co/BelleGroup/BELLE-7B-2M)
  - [Firefly](https://github.com/yangjianxin1/Firefly)
      - [firefly-1b4](https://huggingface.co/YeungNLP/firefly-1b4)
      - [firefly-2b6](https://huggingface.co/YeungNLP/firefly-2b6)
  - [Baize](https://github.com/project-baize/baize-chatbot)
      - [baize-lora-7b](https://huggingface.co/project-baize/baize-lora-7B)
  - [GODEL](https://github.com/microsoft/GODEL)
      - [GODEL-v1_1-base-seq2seq](https://huggingface.co/microsoft/GODEL-v1_1-base-seq2seq)
      - [GODEL-v1_1-large-seq2seq](https://huggingface.co/microsoft/GODEL-v1_1-large-seq2seq)
  - [StableLM](https://github.com/Stability-AI/StableLM)
      - [stablelm-tuned-alpha-3b](https://huggingface.co/stabilityai/stablelm-tuned-alpha-3b)
      - [stablelm-tuned-alpha-7b](https://huggingface.co/stabilityai/stablelm-tuned-alpha-7b)
  - [Vicuna](https://github.com/lm-sys/FastChat)
      - [vicuna-7b-delta-v1.1](https://huggingface.co/lmsys/vicuna-7b-delta-v1.1)
      - [vicuna-13b-delta-v1.1](https://huggingface.co/lmsys/vicuna-13b-delta-v1.1)
  - [FastChat-T5](https://github.com/lm-sys/FastChat)
      - [fastchat-t5-3b-v1.0](https://huggingface.co/lmsys/fastchat-t5-3b-v1.0)

##### æ·»åŠ è‡ªå·±çš„æ¨¡å‹

æ‚¨ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„å¯¹è¯æ¨¡å‹ï¼Œä»¥ä¸‹æä¾›ä¸¤ç§æ–¹å¼ï¼š

ğŸ‘‰**ä¼˜å…ˆæ¨è**ï¼ˆHuggingFaceæ¨¡å‹ï¼‰
å¯¹äºHuggingFaceä¸­çš„æ¨¡å‹ğŸ¤—ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹`config.py`ä¸­çš„éƒ¨åˆ†å­—æ®µæ¥å¯¼å…¥æ‚¨éœ€è¦çš„æ¨¡å‹ï¼Œæ¯”å¦‚æ‚¨æƒ³æ·»åŠ `llama`æ¨¡å‹ï¼Œåˆ™å¯ä»¥å°†`config.py`çš„`model_list`å­—æ®µä¿®æ”¹å¦‚ä¸‹ï¼š

```python
model_list = [
    {
        # æ¨¡å‹åç§°ï¼ˆå‚è€ƒHuggingFaceä¸­çš„åç§°ï¼Œå¿…éœ€ï¼‰
        "model_name_or_path": "decapoda-research/llama-7b-hf",
        # æ¨¡å‹æ˜µç§°ï¼ˆç»™æ¨¡å‹çš„è‡ªå®šä¹‰åç§°ï¼Œå¿…éœ€ä¸”ä¸é‡å¤ï¼‰
        "nickname": "llama",
        # Tokenizerè·¯å¾„ï¼ˆå‚è€ƒHuggingFaceä¸­çš„åç§°ï¼Œå¿…éœ€ï¼‰
        "tokenizer_path": "decapoda-research/llama-7b-hf",
        # ç”Ÿæˆå‚æ•°ï¼ˆå¿…é¡»æŒ‡å®šï¼‰
        "generate_kwargs": {
            "max_length": 2048
        },
        # GPU
        "devices": "3",
        # æ•°æ®ç±»å‹
        "dtype": "float16",
        # åŸºç¡€æ¨¡å‹ï¼ˆä»…åœ¨LoRAçš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ï¼‰
        "base_model": None,
        # Promptï¼ˆå¿…é¡»æŒ‡å®šï¼‰
        "prompts": {
             "meta_prompt": "",
             "user_prompt": "é—®: {}\n",
             "bot_prompt": "ç­”: {}\n"
         }
    }
]
```

ğŸ‘‰**å¦ä¸€ç§æ–¹å¼**ï¼ˆéHuggingFaceæ¨¡å‹çš„æƒ…å†µï¼‰

###### 1. ç»§æ‰¿ ChatBOT ç±»

æ‚¨å¯ä»¥é€šè¿‡åœ¨ `generator/` è·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç»§æ‰¿ [ChatBOT](https://github.com/OpenLMLab/ChatZoo/blob/main/generator/chatbot.py) æ¥å±•ç¤ºæ‚¨è‡ªå·±çš„å¯¹è¯æ¨¡å‹ã€‚è€Œå¦‚æœæ‚¨çš„æ¨¡å‹æ˜¯åŸºäº [ğŸ¤—huggingface](https://huggingface.co/models) ä¸­çš„æ¨¡å‹å®ç°çš„ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ç»§æ‰¿ [TransformersChatBOT](https://github.com/OpenLMLab/ChatZoo/blob/main/generator/transformersbot.py) ç±»ã€‚æ‚¨éœ€è¦å®ç°ä»¥ä¸‹å‡½æ•°æˆ–å±æ€§ï¼š

- `load_tokenizer(self)`ï¼šä» `config.tokenizer_path` ä¸­åŠ è½½ `tokenizer` çš„å‡½æ•°ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `get_prompt(self, query)`ï¼šä»èŠå¤©è®°å½• `query` ä¸­æ„é€ æ¨¡å‹è¾“å…¥çš„ promptã€‚`query` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä»£è¡¨ä¸€æ¡èŠå¤©è®°å½•ã€‚å…¶æ ¼å¼ä¸ºï¼š

```python
[
    {"role":"HUMAN", "content":"ä½ å¥½ï¼ä½ æ˜¯è°ï¼Ÿ"},
    {"role":"BOT", "content": "ä½ å¥½ï¼æˆ‘æ˜¯æœºå™¨äººï¼"},
    {"role":"HUMAN", "content": "ä»Šå¤©å¤©æ°”ä¸é”™ï¼"}
]
```

- `get_input(self, prompt)`ï¼šä» `prompt` ä¸­è·å–è¾“å…¥çš„å‡½æ•°ã€‚`prompt` å³ä¸º `get_prompt` å‡½æ•°çš„è¿”å›å€¼ï¼Œæ‚¨éœ€è¦åœ¨è¯¥å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªå­—å…¸ä½œä¸ºæ¨¡å‹ç”Ÿæˆçš„è¾“å…¥ã€‚æ¯”å¦‚åœ¨ `TransformersChatBOT` ä¸­ï¼Œè¯¥å‡½æ•°è¿”å›çš„æ˜¯è°ƒç”¨ `tokenizer` åå¾—åˆ°çš„å­—å…¸ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `default_settings(self)`ï¼šé…ç½®ç”Ÿæˆå‚æ•°çš„å‡½æ•°ï¼Œæ¯”å¦‚ `num_beams`ã€`top_k`ã€`top_p` ç­‰å†³å®šç”Ÿæˆç­–ç•¥çš„å‡½æ•°ã€‚è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œkey ä¸ºå‚æ•°åï¼Œvalue ä¸ºé»˜è®¤å€¼ï¼Œå‰ç«¯ç•Œé¢ä¼šæ ¹æ®è¿™äº›ä¿¡æ¯æ¥å®šåˆ¶ç”Ÿæˆé…ç½®çš„æ§ä»¶ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `extra_settings(self)`: é…ç½®å…¶å®ƒå‚æ•°çš„å‡½æ•°ï¼Œæ¯”å¦‚ `eos_token_id` ç­‰å›ºå®šçš„é¢å¤–å‚æ•°ã€‚è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œkey ä¸ºå‚æ•°åï¼Œvalue ä¸ºé»˜è®¤å€¼ï¼Œè¯¥å­—å…¸ä¼šä¸ç½‘é¡µä¸­è®¾ç½®çš„å‚æ•°ä¸€èµ·ä½œä¸º `gen_kwargs` ä¼ å…¥åˆ°ç”Ÿæˆå‡½æ•°ä¸­ã€‚
- `generate(self, input_dict, gen_kwargs)`ï¼šæ‰§è¡Œç”Ÿæˆæ­¥éª¤çš„å‡½æ•°ã€‚`input_dict` æ˜¯ `get_input` è¿”å›çš„å­—å…¸ï¼Œ`gen_kwargs` æ˜¯ç”Ÿæˆé…ç½®ï¼Œè¿™ä¸€æ­¥ä¸»è¦è°ƒç”¨æ¨¡å‹çš„ç”Ÿæˆæ–¹æ³•è¿›è¡Œç”Ÿæˆã€‚æ¯”å¦‚åœ¨ `TransformersChatBOT` ä¸­ï¼Œè¯¥å‡½æ•°ä¼šè°ƒç”¨ `model.generate` æ–¹æ³•ï¼Œç„¶åå°†ç»“æœè¿”å›ã€‚å¦‚æœè¾“å…¥çš„ token æ•°ç›®è¿‡é•¿ï¼Œè¿™ä¸ªå‡½æ•°è¿”å› `None`ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `get_response(self, output, input_dict)`ï¼šè·å–æ¨¡å‹å½“è½®å›å¤çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚`output` æ˜¯ `generate` å‡½æ•°çš„è¿”å›å€¼ï¼Œ`input_dict` æ˜¯ `get_input` å‡½æ•°çš„è¿”å›å€¼ã€‚è¿™ä¸ªå‡½æ•°ä¸»è¦ç”¨äºæå–æ¨¡å‹çš„å›å¤ï¼Œæ¯”å¦‚ä»ç”Ÿæˆç»“æœä¸­åˆ é™¤å‰é¢çš„å†å²è®°å½•éƒ¨åˆ†å¹¶ä½¿ç”¨ `tokenizer` è¿›è¡Œè§£ç ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `process_response(self, response)`ï¼šå¯¹æ¨¡å‹å›å¤è¿›è¡Œå¤„ç†çš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚`response` æ˜¯ `get_response` å‡½æ•°çš„è¿”å›å€¼ï¼Œè¯¥å‡½æ•°ä¸»è¦ç”¨äºæ›¿æ¢ `response` ä¸­çš„ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚ `<s>` `<eoh>` ç­‰ã€‚èŠå¤©ç•Œé¢ä¸­å±•ç¤ºçš„æ¨¡å‹å½“è½®å›å¤å°±æ˜¯è¯¥å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ‚¨ä¸éœ€è¦å¯¹ç”Ÿæˆçš„å­—ç¬¦ä¸²è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `load_model(self)`ï¼šä» `config.pretrained_path` ä¸­åŠ è½½æ¨¡å‹çš„å‡½æ•°ã€‚å¦‚æœæ‚¨ç»§æ‰¿çš„æ˜¯ `TransformersChatBOT`ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æ‚¨æ— éœ€é‡å†™ã€‚
- `model_cls`ï¼š`TransformersChatBOT` éœ€è¦çš„å±æ€§ï¼Œéœ€è¦æ·»åŠ  `@property` è£…é¥°å™¨ã€‚ç”¨äºæŒ‡å®šæ‚¨çš„æ¨¡å‹ç±»ã€‚

###### 2. æ„å»ºæ˜ å°„å…³ç³»ï¼ˆå¯é€‰ï¼‰

å½“æ‚¨å®šä¹‰äº†æ‚¨è‡ªå·±çš„ `ChatBOT` åï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡å‚æ•° `--type` `--pretrained_path` å’Œ `--tokenizer_path`ï¼ˆå¯é€‰ï¼‰æ¥ä½¿ç”¨æ‚¨è‡ªå·±çš„èŠå¤©æœºå™¨äººäº†ã€‚å…¶ä¸­ `--type` çš„å€¼åº”ä¸ºæ‚¨è‡ªå·±çš„ `ChatBOT` æ‰€åœ¨çš„æ–‡ä»¶åï¼Œå¯åŠ¨æ—¶ `ChatZoo` ä¼šè‡ªåŠ¨æ ¹æ®æ–‡ä»¶ååŒ¹é…å¹¶å¯¼å…¥åˆé€‚çš„ç±»ã€‚

å¦‚æœæ‚¨æƒ³ä¸€åŠ³æ°¸é€¸ï¼Œé‚£ä¹ˆæ‚¨è¿˜å¯ä»¥åœ¨ [config.py](https://github.com/OpenLMLab/ChatZoo/blob/main/config.py) ä¸­å°†æ‚¨çš„é¢„è®­ç»ƒè·¯å¾„ä¸ `ChatBOT` æ–‡ä»¶åçš„å¯¹åº”å…³ç³»æ·»åŠ åˆ° `MODEL_NAME_TO_MODEL_DICT` å­—å…¸ä¸­ã€‚è¿™æ ·æ‚¨åœ¨å¯åŠ¨åç«¯æ—¶å°±ä¸å¿…ä½¿ç”¨ `--type` å‚æ•°äº†ã€‚

#### å¤–éƒ¨ç½‘é¡µæ¥å…¥

æ•¬è¯·æœŸå¾…...

#### é¢„è®¾æ¨¡å‹

æ•¬è¯·æœŸå¾…...

### æ¨¡å¼ä»‹ç»

é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼ŒChatZooæä¾›ä¸¤ç§æ¨¡å¼ï¼š**è°ƒè¯•æ¨¡å¼**å’Œ**ç«æŠ€åœºæ¨¡å¼**ã€‚æ‚¨å¯ä»¥åœ¨`config.py`ä¸­ä¿®æ”¹`mode`æ¥åˆ‡æ¢ä¸åŒçš„æ¨¡å¼ã€‚

#### è°ƒè¯•æ¨¡å¼

åœ¨`config.py`ä¸­ï¼Œ

```bash
mode = "debug"
```

è°ƒè¯•æ¨¡å¼é€‚ç”¨äºæ¨¡å‹çš„å¼€å‘è€…ï¼Œä½ å¯ä»¥åœ¨**æ¨¡å‹ç®¡ç†**ç•Œé¢ä¿®æ”¹æ¨¡å‹é…ç½®ã€å¢åˆ æ¨¡å‹ã€‚

##### ä¿®æ”¹æ¨¡å‹é…ç½®

æ‚¨å¯ä»¥ç‚¹å‡»æŸä¸ªæ¨¡å‹ä¸Šæ–¹çš„é…ç½®æŒ‰é’®ï¼Œä»è€Œæ‰“å¼€ä¿®æ”¹é…ç½®å¼¹çª—ã€‚
åœ¨ä¿®æ”¹å®Œé…ç½®åï¼Œç‚¹å‡»`ä¿å­˜`å³å¯æˆåŠŸä¿®æ”¹ã€‚

##### æ–°å¢æ¨¡å‹

ç‚¹å‡»å³ä¸‹è§’çš„+ï¼Œå³å¯åœ¨ç•Œé¢ä¸­åŠ å…¥æ–°çš„æ¨¡å‹ï¼ˆæ³¨æ„ChatZooè¦æ±‚æœ€å¤šç•Œé¢ä¸­åŒæ—¶å‡ºç°4ä¸ªæ¨¡å‹ï¼‰ã€‚ChatZooæä¾›ä¸‰ç§æ¨¡å‹å¯¼å…¥çš„æ–¹å¼ï¼š

* **æœ¬åœ°æ¨¡å‹**
  * æ¨¡å‹åç§°ï¼šæ¨¡å‹çš„è‡ªå®šä¹‰å‘½åï¼ˆæ³¨æ„å„ä¸ªæ¨¡å‹çš„åå­—è¦æ±‚å”¯ä¸€ï¼‰
  * æ¨¡å‹URLï¼šæ¨¡å‹éƒ¨ç½²çš„åœ°å€ï¼ˆé€šå¸¸åœ¨

* **å¤–éƒ¨ç½‘é¡µæ¥å…¥**
  * æ¨¡å‹åç§°ï¼šæ¨¡å‹çš„è‡ªå®šä¹‰å‘½åï¼ˆæ³¨æ„å„ä¸ªæ¨¡å‹çš„åå­—è¦æ±‚å”¯ä¸€ï¼‰
  * æ¨¡å‹URLï¼šæ¨¡å‹çš„APIæ¥å£

* **é¢„è®¾æ¨¡å‹**
  é€‰æ‹©æ‚¨éœ€è¦çš„æ¨¡å‹å³å¯ã€‚

##### åˆ é™¤æ¨¡å‹

ç‚¹å‡»æŸä¸ªæ¨¡å‹å³ä¸Šè§’çš„Ã—ï¼Œå³å¯å°†è¯¥æ¨¡å‹ä»ç•Œé¢ä¸­ç§»é™¤ã€‚

#### ç«æŠ€åœºæ¨¡å¼

åœ¨`config.py`ä¸­ï¼Œ

```python
mode = "arena"
```

ç«æŠ€åœºæ¨¡å¼é€‚åˆæ ‡æ³¨è€…ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œæ‚¨æ— æ³•å¯¹æ¨¡å‹è¿›è¡Œä¿®æ”¹ï¼Œåªèƒ½ä¸æ¨¡å‹è¿›è¡Œä¼šè¯å¹¶æ ‡æ³¨ã€‚ä¸æ¨¡å‹çš„ä¼šè¯ä¹Ÿåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š**ä¼šè¯æ ‡æ³¨**å’Œ**å•å›å¤æ ‡æ³¨**ã€‚

* **ä¼šè¯æ ‡æ³¨**
åœ¨ä¼šè¯æ ‡æ³¨æ¨¡å¼ä¸‹ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°ä¸å¤§æ¨¡å‹è¿›è¡ŒèŠå¤©ï¼Œå¹¶ä¸”åœ¨ä»»æ„æ—¶å€™ç‚¹å‡»â€œæ ‡æ³¨â€ï¼Œä¸ºæ‚¨å–œæ¬¢çš„å¤§æ¨¡å‹è¿›è¡ŒæŠ•ç¥¨ã€‚å½“æ‚¨æ ‡æ³¨ç»“æŸåï¼Œè¯¥ä¼šè¯å°†è¢«æ ‡è®°ä¸ºâ€œå·²æ ‡æ³¨â€çŠ¶æ€ï¼Œå°†ä¸èƒ½å†è¿›è¡Œæ ‡æ³¨ã€‚

* **å•å›å¤æ ‡æ³¨**
åœ¨å•å›å¤æ ‡æ³¨æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€æ¬¡ä¸å¤§æ¨¡å‹èŠå¤©åï¼Œéƒ½éœ€è¦è¿›è¡Œæ ‡æ³¨ï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€è½®å¯¹è¯ã€‚

### ç»“æœåˆ†æ

å½“æ‚¨å®Œæˆæ ‡æ³¨åï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤

```bash
python tools/elo_score.py --config config.py
```

ç”Ÿæˆç»Ÿè®¡æ•°æ®ä¸ç»“æœåˆ†æã€‚
![Result](docs/pics/result.png)

## å¼•ç”¨æˆ‘ä»¬
```
@misc{2023chatzoo,
    title={ChatZoo: Chat with Models to Debug, Evaluate, and Annotate.},
    author={OpenLMLab},
    howpublished = {\url{https://github.com/OpenLMLab/ChatZoo}},
    year={2023}
}
```
